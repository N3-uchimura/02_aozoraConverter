<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <title>Aozora Converter</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline';">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/button.css">
</head>

<body>
  <h1 id="maintitle">Aozora Converter</h1>
  <div class="operation_area">
    <h3 id="selectdir">Select Directory</h3>
    <button id="selectdir_button" class="button-g button-wide" value="selectdir" onclick="gotoSelectDir();">Select
      Directory</button>
  </div>
  <p><i class="arrow down"></i></p>
  <div class="operation_area">
    <h3 id="converter">Convert</h3>
    <label id="qualitylabel" for="quality">quality</label>
    <input type="number" id="quality" name="quality" min="48" max="320" value="92" /><br><br>
    <label id="samplingratelabel" for="samplingrate">sampling rate</label>
    <select name="samplingrate" id="samplingrate">
      <option value="11025">11025 Hz</option>
      <option value="22050">22050 Hz</option>
      <option value="44100" selected>44100 Hz</option>
      <option value="88200">88200 Hz</option>
      <option value="96000">96000 Hz</option>
      <option value="192000">192000 Hz</option>
    </select><br><br>
    <button id="convert_button" class="button-g button-wide" value="convert" onclick="gotoConvert();">Convert</button>
  </div>
  <div class="config_area">
    <h3 id="config">Config</h3>
    <button id="config_button" class="button-g button-6 button-wide" value="config"
      onclick="gotoConfig()">Config</button>
  </div>
  <div class="status_area">
    <h3 id="statushead">Status</h3>
    <div id="status"></div>
    <div id="targetpage"></div>
    <div id="error"></div>
  </div>
  <div class="exit_area">
    <button id="exit_button" class="button-g button-1 button-wide" value="exit" onclick="exitApp();">Exit</button>
  </div>
  <footer>
    <p><small>&copy; 2025 Nthree All Rights Reserved. </small></p>
  </footer>

  <script charset="UTF-8">
    /// constants
    // japanese
    const APPNAME_STR_JA = '青空コンバータ';
    const SELECTDIR_STR_JA = 'フォルダ選択';
    const QUALITY_STR_JA = '音声品質';
    const SAMPLINGRATE_STR_JA = 'サンプリング周波数';
    const CONVERT_STR_JA = 'ファイル変換';
    const STATUS_STR_JA = 'ステータス';
    const CONFIG_STR_JA = '設定';
    const EXIT_STR_JA = '終了';
    // english
    const APPNAME_STR_EN = 'Aozora Converter';
    const SELECTDIR_STR_EN = 'Select Directory';
    const QUALITY_STR_EN = 'quality';
    const SAMPLINGRATE_STR_EN = 'sampling rate';
    const CONVERT_STR_EN = 'Convert';
    const STATUS_STR_EN = 'Status';
    const CONFIG_STR_EN = 'Config';
    const EXIT_STR_EN = 'Exit';
    /// doms
    const maintitleDom = document.getElementById("maintitle");
    const selectdirDom = document.getElementById('selectdir');
    const selectdirButtonDom = document.getElementById('selectdir_button');
    const convertDom = document.getElementById('convert');
    const convertButtonDom = document.getElementById('convert_button');
    const qualitylabelDom = document.getElementById('qualitylabel');
    const qualityDom = document.getElementById('quality');
    const samplingratelabelDom = document.getElementById('samplingratelabel');
    const samplingrateDom = document.getElementById('samplingrate');
    const statusDom = document.getElementById('status');
    const errorDom = document.getElementById('error');
    const statusHeadDom = document.getElementById('statushead');
    const pageDom = document.getElementById('targetpage');
    const configDom = document.getElementById('config');
    const configButtonDom = document.getElementById('config_button');
    const exitButtonDom = document.getElementById('exit_button');
    const selectVoiceDom = document.getElementById("voicemodel");

    /// ipc
    // before ready
    window.api.send("beforeready");

    // be ready
    window.api.on("ready", arg => {
      console.log('ready');
      // change language
      changeLanguage(arg);
    });

    // update status
    window.api.on('statusUpdate', arg => {
      try {
        console.log(arg);
        // status 
        statusDom.innerHTML = arg.status;
        // target
        pageDom.innerHTML = arg.target;

      } catch (e) {
        // error
        console.log(e);
      }
    });

    // update error
    window.api.on('errorUpdate', arg => {
      try {
        console.log(arg);
        // error 
        errorDom.innerHTML = arg;

      } catch (e) {
        // error
        console.log(e);
      }
    });

    // start selectdir
    const gotoSelectDir = () => {
      try {
        console.log('select dir');
        // directory selected
        const tmpSelectedDir = selectdirDom.value;
        // selectdir
        window.api.send('selectdir', tmpSelectedDir);

      } catch (e) {
        // error
        console.log(e);
      }
    }

    // start converting
    const gotoConvert = () => {
      try {
        console.log('converting');
        const sendobj = {
          quality: qualityDom.value,
          rate: samplingrateDom.value,
        }
        // convert
        window.api.send('convert', sendobj);

      } catch (e) {
        // error
        console.log(e);
      }
    }

    // goto config page
    const gotoConfig = () => {
      try {
        console.log('goto config');
        // config
        window.api.send('config');

      } catch (e) {
        // error
        console.log(e);
      }
    }

    // exit
    const exitApp = () => {
      try {
        console.log('exit');
        // exit app
        window.api.send('exit');

      } catch (e) {
        // error
        console.log(e);
      }
    }

    // change language
    const changeLanguage = lang => {
      // japanese
      if (lang == 'japanese') {
        document.title = APPNAME_STR_JA;
        maintitleDom.innerHTML = APPNAME_STR_JA;
        selectdirDom.innerHTML = SELECTDIR_STR_JA;
        selectdirButtonDom.innerHTML = SELECTDIR_STR_JA;
        qualitylabelDom.innerHTML = QUALITY_STR_JA;
        samplingratelabelDom.innerHTML = SAMPLINGRATE_STR_JA;
        convertDom.innerHTML = CONVERT_STR_JA;
        convertButtonDom.innerHTML = CONVERT_STR_JA;
        statusHeadDom.innerHTML = STATUS_STR_JA;
        configDom.innerHTML = CONFIG_STR_JA;
        configButtonDom.innerHTML = CONFIG_STR_JA;
        exitButtonDom.innerHTML = EXIT_STR_JA;
        document.documentElement.setAttribute("lang", 'ja');
        // english
      } else {
        document.title = APPNAME_STR_EN;
        maintitleDom.innerHTML = APPNAME_STR_EN;
        selectdirDom.innerHTML = SELECTDIR_STR_EN;
        selectdirButtonDom.innerHTML = SELECTDIR_STR_EN;
        qualitylabelDom.innerHTML = QUALITY_STR_EN;
        samplingratelabelDom.innerHTML = SAMPLINGRATE_STR_EN;
        convertDom.innerHTML = CONVERT_STR_EN;
        convertButtonDom.innerHTML = CONVERT_STR_EN;
        statusHeadDom.innerHTML = STATUS_STR_EN;
        configDom.innerHTML = CONFIG_STR_EN;
        configButtonDom.innerHTML = CONFIG_STR_EN;
        exitButtonDom.innerHTML = EXIT_STR_EN;
        document.documentElement.setAttribute("lang", 'en');
      }
    }
  </script>
</body>

</html>